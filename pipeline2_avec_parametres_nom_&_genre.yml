pipeline {
    agent any

    parameters {
        string(name: 'NAME', description: 'Quel est ton prénom ?')
        choice(name: 'GENDER', choices: ['Male', 'Female'], description: 'Genre')
        choice(name: 'ENV', choices: ['dev', 'test', 'prod'], description: 'Environnement de déploiement')
    }

    environment {
        GREETING = ''
    }

    stages {
        stage('Bonjour personnalisé') {
            steps {
                script {
                    def name = params.NAME
                    def gender = params.GENDER
                    if (gender == "Male") {
                        env.GREETING = "Bonjour Mr. ${name}"
                    } else {
                        env.GREETING = "Bonjour Mme ${name}"
                    }
                    echo "${env.GREETING}"
                }
            }
        }

        stage('BUILD') {
            steps {
                echo 'Étape de build...'
                // ex: sh 'npm install' ou './gradlew build'
            }
        }

        stage('TEST') {
            steps {
                echo 'Exécution des tests...'
                // ex: sh 'npm test' ou './gradlew test'
            }
        }

        stage('DEPLOY') {
            when {
                expression { return params.ENV == 'prod' }
            }
            steps {
                echo "Déploiement en ${params.ENV}..."
                // ex: sh 'scp app.jar user@prod-server:/app'
            }
        }
    }

    post {
        always {
            echo 'Pipeline terminé.'
        }
    }
}
